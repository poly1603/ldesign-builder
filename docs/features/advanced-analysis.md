# é«˜çº§åˆ†æåŠŸèƒ½

@ldesign/builder æä¾›äº†ä¸€å¥—å¼ºå¤§çš„é«˜çº§åˆ†æåŠŸèƒ½ï¼Œå¸®åŠ©å¼€å‘è€…æ·±å…¥äº†è§£é¡¹ç›®ç»“æ„ã€ä¼˜åŒ–æ„å»ºæ€§èƒ½ã€ç®¡ç†ä¾èµ–å…³ç³»å’Œæå‡ä»£ç è´¨é‡ã€‚

## åŠŸèƒ½æ¦‚è§ˆ

### ğŸ” æ™ºèƒ½ä¾èµ–åˆ†æ
- **æ·±åº¦ä¾èµ–æ‰«æ**: åˆ†æé¡¹ç›®ä¸­çš„æ‰€æœ‰ä¾èµ–å…³ç³»
- **å®‰å…¨æ¼æ´æ£€æµ‹**: è¯†åˆ«ä¾èµ–åŒ…ä¸­çš„å®‰å…¨é—®é¢˜
- **å¾ªç¯ä¾èµ–æ£€æµ‹**: å‘ç°å¹¶æŠ¥å‘Šå¾ªç¯ä¾èµ–é—®é¢˜
- **æœªä½¿ç”¨ä¾èµ–è¯†åˆ«**: æ‰¾å‡ºé¡¹ç›®ä¸­æœªä½¿ç”¨çš„ä¾èµ–åŒ…
- **åŒ…å¤§å°åˆ†æ**: è¯„ä¼°ä¾èµ–å¯¹æœ€ç»ˆbundleå¤§å°çš„å½±å“

### âš¡ æ„å»ºæ€§èƒ½ç›‘æ§
- **å®æ—¶æ€§èƒ½è·Ÿè¸ª**: ç›‘æ§æ„å»ºè¿‡ç¨‹ä¸­æ¯ä¸ªé˜¶æ®µçš„æ€§èƒ½
- **å†…å­˜ä½¿ç”¨åˆ†æ**: è·Ÿè¸ªæ„å»ºè¿‡ç¨‹ä¸­çš„å†…å­˜ä½¿ç”¨æƒ…å†µ
- **ç“¶é¢ˆè¯†åˆ«**: è‡ªåŠ¨è¯†åˆ«æ„å»ºè¿‡ç¨‹ä¸­çš„æ€§èƒ½ç“¶é¢ˆ
- **ä¼˜åŒ–å»ºè®®**: åŸºäºåˆ†æç»“æœæä¾›å…·ä½“çš„ä¼˜åŒ–å»ºè®®
- **æ€§èƒ½æŠ¥å‘Š**: ç”Ÿæˆè¯¦ç»†çš„æ€§èƒ½åˆ†ææŠ¥å‘Š

### ğŸ“¦ ä»£ç åˆ†å‰²ä¼˜åŒ–
- **æ™ºèƒ½åˆ†å‰²ç­–ç•¥**: æ”¯æŒå¤šç§ä»£ç åˆ†å‰²ç­–ç•¥
- **ä¾èµ–å›¾åˆ†æ**: æ„å»ºå®Œæ•´çš„æ¨¡å—ä¾èµ–å…³ç³»å›¾
- **å—å¤§å°ä¼˜åŒ–**: æ™ºèƒ½æ§åˆ¶ä»£ç å—çš„å¤§å°å’Œæ•°é‡
- **æ‡’åŠ è½½å»ºè®®**: ä¸ºå¤§å‹ç»„ä»¶æä¾›æ‡’åŠ è½½ä¼˜åŒ–å»ºè®®
- **ç¼“å­˜æ•ˆç‡ä¼˜åŒ–**: æå‡ä»£ç åˆ†å‰²çš„ç¼“å­˜æ•ˆç‡

### ğŸš€ æ„å»ºç¼“å­˜ç®¡ç†
- **æ™ºèƒ½ç¼“å­˜ç­–ç•¥**: æ”¯æŒLRUã€LFUç­‰å¤šç§ç¼“å­˜ç­–ç•¥
- **ä¾èµ–è·Ÿè¸ª**: è·Ÿè¸ªç¼“å­˜æ¡ç›®ä¹‹é—´çš„ä¾èµ–å…³ç³»
- **è‡ªåŠ¨å¤±æ•ˆ**: å½“ä¾èµ–æ–‡ä»¶å˜åŒ–æ—¶è‡ªåŠ¨å¤±æ•ˆç›¸å…³ç¼“å­˜
- **å‹ç¼©å­˜å‚¨**: æ”¯æŒç¼“å­˜æ•°æ®çš„å‹ç¼©å­˜å‚¨
- **ç»Ÿè®¡åˆ†æ**: æä¾›è¯¦ç»†çš„ç¼“å­˜ä½¿ç”¨ç»Ÿè®¡ä¿¡æ¯

## å¿«é€Ÿå¼€å§‹

### å®‰è£…å’Œé…ç½®

```bash
npm install @ldesign/builder
```

åœ¨ä½ çš„æ„å»ºé…ç½®ä¸­å¯ç”¨é«˜çº§åŠŸèƒ½ï¼š

```typescript
// builder.config.ts
import { defineConfig } from '@ldesign/builder'

export default defineConfig({
  input: 'src/index.ts',
  outDir: 'dist',
  
  // å¯ç”¨é«˜çº§åˆ†æåŠŸèƒ½
  advanced: {
    dependencyAnalysis: {
      enabled: true,
      enableSecurityCheck: true,
      enableBundleSizeAnalysis: true
    },
    
    performanceAnalysis: {
      enabled: true,
      enableMemoryTracking: true
    },
    
    codeSplitting: {
      enabled: true,
      strategy: 'hybrid'
    },
    
    caching: {
      enabled: true,
      strategy: 'lru'
    }
  }
})
```

### åŸºæœ¬ä½¿ç”¨

```typescript
import {
  DependencyAnalyzer,
  BuildPerformanceAnalyzer,
  CodeSplittingOptimizer,
  BuildCacheManager
} from '@ldesign/builder'

// ä¾èµ–åˆ†æ
const depAnalyzer = new DependencyAnalyzer()
const depResult = await depAnalyzer.analyze('/path/to/project')

// æ€§èƒ½ç›‘æ§
const perfAnalyzer = new BuildPerformanceAnalyzer()
perfAnalyzer.startPhase('build')
// ... æ‰§è¡Œæ„å»º
const phaseResult = perfAnalyzer.endPhase('build')

// ä»£ç åˆ†å‰²ä¼˜åŒ–
const optimizer = new CodeSplittingOptimizer()
const splittingResult = await optimizer.optimize({
  rootDir: '/path/to/project',
  entries: ['src/index.ts']
})

// ç¼“å­˜ç®¡ç†
const cacheManager = new BuildCacheManager()
await cacheManager.set('build-key', buildResult)
const cached = await cacheManager.get('build-key')
```

## ä½¿ç”¨åœºæ™¯

### 1. é¡¹ç›®å¥åº·æ£€æŸ¥

ä½¿ç”¨ä¾èµ–åˆ†æå™¨å¯¹é¡¹ç›®è¿›è¡Œå…¨é¢çš„å¥åº·æ£€æŸ¥ï¼š

```typescript
async function projectHealthCheck(projectPath: string) {
  const analyzer = new DependencyAnalyzer({
    enableSecurityCheck: true,
    enableCircularDependencyCheck: true,
    enableUnusedDependencyCheck: true
  })
  
  const result = await analyzer.analyze(projectPath)
  
  console.log('ğŸ“Š é¡¹ç›®ä¾èµ–åˆ†ææŠ¥å‘Š')
  console.log(`æ€»ä¾èµ–æ•°: ${result.summary.total}`)
  console.log(`å®‰å…¨é—®é¢˜: ${result.securityIssues?.length || 0}`)
  console.log(`å¾ªç¯ä¾èµ–: ${result.circularDependencies?.length || 0}`)
  console.log(`æœªä½¿ç”¨ä¾èµ–: ${result.unusedDependencies?.length || 0}`)
  
  if (result.recommendations.length > 0) {
    console.log('\nğŸ’¡ ä¼˜åŒ–å»ºè®®:')
    result.recommendations.forEach(rec => console.log(`- ${rec}`))
  }
}
```

### 2. æ„å»ºæ€§èƒ½ä¼˜åŒ–

ä½¿ç”¨æ€§èƒ½åˆ†æå™¨è¯†åˆ«å’Œè§£å†³æ„å»ºç“¶é¢ˆï¼š

```typescript
async function optimizeBuildPerformance() {
  const analyzer = new BuildPerformanceAnalyzer({
    enableMemoryTracking: true,
    enableDetailedMetrics: true
  })
  
  // ç›‘æ§æ•´ä¸ªæ„å»ºè¿‡ç¨‹
  analyzer.startPhase('full-build')
  
  analyzer.startPhase('typescript-compilation')
  // TypeScript ç¼–è¯‘...
  analyzer.endPhase('typescript-compilation')
  
  analyzer.startPhase('bundling')
  // æ‰“åŒ…...
  analyzer.endPhase('bundling')
  
  analyzer.startPhase('minification')
  // å‹ç¼©...
  analyzer.endPhase('minification')
  
  analyzer.endPhase('full-build')
  
  // ç”Ÿæˆåˆ†ææŠ¥å‘Š
  const analysis = analyzer.analyze({
    includeRecommendations: true,
    includeBottlenecks: true
  })
  
  console.log('âš¡ æ„å»ºæ€§èƒ½åˆ†æ')
  console.log(`æ€»è€—æ—¶: ${analysis.overall.totalDuration}ms`)
  console.log(`å³°å€¼å†…å­˜: ${analysis.overall.peakMemoryUsage}MB`)
  
  if (analysis.bottlenecks.length > 0) {
    console.log('\nğŸŒ æ€§èƒ½ç“¶é¢ˆ:')
    analysis.bottlenecks.forEach(bottleneck => {
      console.log(`- ${bottleneck.phase}: ${bottleneck.duration}ms`)
    })
  }
  
  if (analysis.recommendations.length > 0) {
    console.log('\nğŸ’¡ ä¼˜åŒ–å»ºè®®:')
    analysis.recommendations.forEach(rec => {
      console.log(`- ${rec.description}`)
    })
  }
}
```

### 3. æ™ºèƒ½ä»£ç åˆ†å‰²

ä½¿ç”¨ä»£ç åˆ†å‰²ä¼˜åŒ–å™¨æ”¹å–„åº”ç”¨åŠ è½½æ€§èƒ½ï¼š

```typescript
async function optimizeCodeSplitting(projectPath: string) {
  const optimizer = new CodeSplittingOptimizer({
    strategy: 'hybrid',
    minChunkSize: 1000,
    maxChunks: 10
  })
  
  const result = await optimizer.optimize({
    rootDir: projectPath,
    entries: ['src/index.ts', 'src/admin.ts'],
    strategy: 'frequency-based'
  })
  
  console.log('ğŸ“¦ ä»£ç åˆ†å‰²åˆ†æ')
  console.log(`å½“å‰å—æ•°: ${result.currentStrategy.chunks?.length || 0}`)
  console.log(`æ¨èå—æ•°: ${result.recommendedStrategies[0]?.chunks?.length || 0}`)
  console.log(`ç¼“å­˜æ•ˆç‡: ${result.metrics.cacheEfficiency}%`)
  
  // åº”ç”¨æ¨èçš„åˆ†å‰²ç­–ç•¥
  const recommendedStrategy = result.recommendedStrategies[0]
  if (recommendedStrategy) {
    console.log(`\næ¨èç­–ç•¥: ${recommendedStrategy.name}`)
    console.log(`æè¿°: ${recommendedStrategy.description}`)
    
    if (recommendedStrategy.recommendations) {
      console.log('\nğŸ’¡ å®æ–½å»ºè®®:')
      recommendedStrategy.recommendations.forEach(rec => {
        console.log(`- ${rec}`)
      })
    }
  }
}
```

### 4. æ„å»ºç¼“å­˜ä¼˜åŒ–

ä½¿ç”¨ç¼“å­˜ç®¡ç†å™¨æå‡é‡å¤æ„å»ºçš„æ€§èƒ½ï¼š

```typescript
async function setupBuildCache() {
  const cacheManager = new BuildCacheManager({
    cacheDir: '.build-cache',
    maxSize: 500 * 1024 * 1024, // 500MB
    strategy: 'lru',
    compression: true
  })
  
  // æ„å»ºå‰æ£€æŸ¥ç¼“å­˜
  const cacheKey = 'main-build-v1'
  const cached = await cacheManager.get(cacheKey)
  
  if (cached) {
    console.log('âœ… ä½¿ç”¨ç¼“å­˜çš„æ„å»ºç»“æœ')
    return cached
  }
  
  console.log('ğŸ”¨ æ‰§è¡Œæ–°çš„æ„å»º...')
  
  // æ‰§è¡Œæ„å»º
  const buildResult = await performBuild()
  
  // ç¼“å­˜æ„å»ºç»“æœ
  await cacheManager.setWithDependencies(cacheKey, buildResult, [
    'src/**/*.ts',
    'package.json',
    'tsconfig.json'
  ])
  
  // æ˜¾ç¤ºç¼“å­˜ç»Ÿè®¡
  const stats = await cacheManager.getStats()
  console.log(`ğŸ’¾ ç¼“å­˜ç»Ÿè®¡: å‘½ä¸­ç‡ ${stats.hitRate}%, å¤§å° ${stats.size} bytes`)
  
  return buildResult
}
```

## æœ€ä½³å®è·µ

### 1. é›†æˆåˆ° CI/CD æµç¨‹

```yaml
# .github/workflows/build.yml
name: Build with Analysis

on: [push, pull_request]

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '18'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Analyze bundle (Markdown)
        run: npx ldesign-builder build --report && npx ldesign-builder analyze -r dist/build-report.json -f md
        
      - name: Build
        run: npx ldesign-builder build
        
      - name: Upload analysis reports
        uses: actions/upload-artifact@v3
        with:
          name: analysis-reports
          path: reports/
```

### 2. å®šæœŸå¥åº·æ£€æŸ¥

```typescript
// scripts/health-check.ts
import { DependencyAnalyzer } from '@ldesign/builder'

async function weeklyHealthCheck() {
  const analyzer = new DependencyAnalyzer({
    enableSecurityCheck: true,
    enableUnusedDependencyCheck: true
  })
  
  const result = await analyzer.analyze(process.cwd())
  
  // ç”ŸæˆæŠ¥å‘Š
  const report = {
    date: new Date().toISOString(),
    securityIssues: result.securityIssues?.length || 0,
    unusedDependencies: result.unusedDependencies?.length || 0,
    recommendations: result.recommendations
  }
  
  // å‘é€åˆ°ç›‘æ§ç³»ç»Ÿæˆ–ä¿å­˜åˆ°æ–‡ä»¶
  await saveHealthReport(report)
  
  // å¦‚æœæœ‰ä¸¥é‡é—®é¢˜ï¼Œå‘é€è­¦æŠ¥
  if (report.securityIssues > 0) {
    await sendAlert(`å‘ç° ${report.securityIssues} ä¸ªå®‰å…¨é—®é¢˜`)
  }
}

// æ¯å‘¨è¿è¡Œä¸€æ¬¡
setInterval(weeklyHealthCheck, 7 * 24 * 60 * 60 * 1000)
```

### 3. æ€§èƒ½åŸºå‡†æµ‹è¯•

```typescript
// scripts/performance-benchmark.ts
import { BuildPerformanceAnalyzer } from '@ldesign/builder'

async function runPerformanceBenchmark() {
  const analyzer = new BuildPerformanceAnalyzer()
  
  // è¿è¡Œå¤šæ¬¡æ„å»ºä»¥è·å¾—å¹³å‡æ€§èƒ½æ•°æ®
  const results = []
  
  for (let i = 0; i < 5; i++) {
    analyzer.reset()
    analyzer.startPhase('benchmark-build')
    
    // æ‰§è¡Œæ„å»º
    await performCleanBuild()
    
    analyzer.endPhase('benchmark-build')
    
    const analysis = analyzer.analyze()
    results.push(analysis.overall.totalDuration)
  }
  
  const averageTime = results.reduce((a, b) => a + b, 0) / results.length
  
  console.log(`ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•ç»“æœ:`)
  console.log(`å¹³å‡æ„å»ºæ—¶é—´: ${averageTime}ms`)
  console.log(`æœ€å¿«æ„å»º: ${Math.min(...results)}ms`)
  console.log(`æœ€æ…¢æ„å»º: ${Math.max(...results)}ms`)
  
  // ä¸å†å²æ•°æ®æ¯”è¾ƒ
  await compareWithBaseline(averageTime)
}
```

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **å†…å­˜ä¸è¶³é”™è¯¯**
   ```typescript
   // è°ƒæ•´å†…å­˜ç›‘æ§é…ç½®
   const analyzer = new BuildPerformanceAnalyzer({
     enableMemoryTracking: true,
     sampleInterval: 500, // é™ä½é‡‡æ ·é¢‘ç‡
     thresholds: {
       memoryLeakThreshold: 100 * 1024 * 1024 // 100MB
     }
   })
   ```

2. **ç¼“å­˜å¤±æ•ˆé—®é¢˜**
   ```typescript
   // æ£€æŸ¥ç¼“å­˜çŠ¶æ€
   const stats = await cacheManager.getStats()
   console.log('ç¼“å­˜ç»Ÿè®¡:', stats)
   
   // æ‰‹åŠ¨æ¸…ç†ç¼“å­˜
   await cacheManager.cleanup()
   ```

3. **åˆ†æè¶…æ—¶**
   ```typescript
   // è®¾ç½®è¶…æ—¶æ—¶é—´
   const analyzer = new DependencyAnalyzer({
     timeout: 60000 // 60ç§’
   })
   ```

### è°ƒè¯•æ¨¡å¼

å¯ç”¨è¯¦ç»†æ—¥å¿—ä»¥ä¾¿è°ƒè¯•ï¼š

```typescript
import { logger, LogLevel } from '@ldesign/builder'

// è®¾ç½®è°ƒè¯•çº§åˆ«
logger.setLevel(LogLevel.DEBUG)

// æ‰€æœ‰åˆ†æå™¨éƒ½ä¼šè¾“å‡ºè¯¦ç»†æ—¥å¿—
const analyzer = new DependencyAnalyzer()
const result = await analyzer.analyze('/project')
```

## ä¸‹ä¸€æ­¥

- æŸ¥çœ‹ [API æ–‡æ¡£](../api/advanced-features.md) äº†è§£è¯¦ç»†çš„æ¥å£è¯´æ˜
- å‚è€ƒ [é…ç½®æŒ‡å—](../configuration.md) å­¦ä¹ å¦‚ä½•é…ç½®é«˜çº§åŠŸèƒ½
- æŸ¥çœ‹ [ç¤ºä¾‹é¡¹ç›®](../examples) äº†è§£å®é™…ä½¿ç”¨æ¡ˆä¾‹
