# ä¸ºä»€ä¹ˆé€‰æ‹© @ldesign/builder

å¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªå‰ç«¯åº“æˆ–ç»„ä»¶åº“ï¼Œ@ldesign/builder å¯èƒ½æ˜¯ä½ æœ€å¥½çš„é€‰æ‹©ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä¸ºä»€ä¹ˆã€‚

## æ ¸å¿ƒä¼˜åŠ¿

### 1. çœŸæ­£çš„é›¶é…ç½®

å¤§å¤šæ•°å·¥å…·å£°ç§°"é›¶é…ç½®"ï¼Œä½†å®é™…ä¸Šï¼š

**å…¶ä»–å·¥å…·**ï¼š
```typescript
// éœ€è¦æ‰‹åŠ¨é…ç½®
export default {
  input: 'src/index.ts',
  output: [
    { format: 'esm', dir: 'es' },
    { format: 'cjs', dir: 'lib' }
  ],
  plugins: [
    typescript(),
    vue(),
    resolve(),
    commonjs(),
    babel(),
    terser()
  ],
  external: ['vue', 'react']
}
// 50+ è¡Œé…ç½®
```

**@ldesign/builder**ï¼š
```bash
# é›¶é…ç½®ï¼Œç›´æ¥æ„å»º
npx ldesign-builder build
```

âœ¨ **è‡ªåŠ¨å®Œæˆ**ï¼š
- æ£€æµ‹å…¥å£æ–‡ä»¶
- è¯†åˆ«æ¡†æ¶ç±»å‹
- é…ç½®æ‰€éœ€æ’ä»¶
- è®¾ç½®è¾“å‡ºæ ¼å¼
- å¤„ç†å¤–éƒ¨ä¾èµ–

### 2. å¤šå¼•æ“ï¼ŒæŒ‰éœ€é€‰æ‹©

ä¸åŒåœºæ™¯éœ€è¦ä¸åŒçš„å·¥å…·ï¼š

```bash
# å¼€å‘ç¯å¢ƒ - æé€Ÿåé¦ˆ
ldesign-builder watch --bundler esbuild
# 10-100x æ›´å¿«ï¼Œæ¯«ç§’çº§çƒ­æ›´æ–°

# ç”Ÿäº§ç¯å¢ƒ - æœ€ä¼˜åŒ–è¾“å‡º  
ldesign-builder build --bundler rollup
# å®Œç¾çš„ Tree-shaking å’Œä»£ç åˆ†å‰²

# å¿«é€Ÿæ„å»º - å¹³è¡¡é€Ÿåº¦å’Œä½“ç§¯
ldesign-builder build --bundler swc
# 20x æ›´å¿«ï¼Œä½“ç§¯æ¥è¿‘ Rollup

# ç°ä»£åŒ–é€‰æ‹©
ldesign-builder build --bundler rolldown
# Rust é©±åŠ¨ï¼Œæœªæ¥è¶‹åŠ¿
```

**å¯¹æ¯”å•å¼•æ“å·¥å…·**ï¼š
- tsup - åªæœ‰ esbuildï¼ˆå¿«ä½†ä½“ç§¯å¤§ï¼‰
- Rollup - åªæœ‰ Rollupï¼ˆæ…¢ä½†ä½“ç§¯å°ï¼‰
- Vite - ä¸»è¦ä¸ºåº”ç”¨è®¾è®¡

### 3. å…¨æ¡†æ¶è‡ªåŠ¨æ£€æµ‹

**é—®é¢˜**ï¼šæ¯ä¸ªæ¡†æ¶éƒ½éœ€è¦ç‰¹å®šé…ç½®

```typescript
// Vue 3 éœ€è¦
import vue from '@vitejs/plugin-vue'

// React éœ€è¦
import react from '@vitejs/plugin-react'

// Svelte éœ€è¦
import svelte from 'rollup-plugin-svelte'

// Solid éœ€è¦
import solid from 'babel-preset-solid'
```

**è§£å†³æ–¹æ¡ˆ**ï¼šè‡ªåŠ¨æ£€æµ‹ + è‡ªåŠ¨é…ç½®

```bash
# æ£€æµ‹åˆ° Vue 3
âœ“ è‡ªåŠ¨é…ç½® @vitejs/plugin-vue
âœ“ è‡ªåŠ¨é…ç½® @vue/compiler-sfc
âœ“ è‡ªåŠ¨å¤„ç† .vue æ–‡ä»¶

# æ£€æµ‹åˆ° React
âœ“ è‡ªåŠ¨é…ç½® @vitejs/plugin-react
âœ“ è‡ªåŠ¨é…ç½® JSX è½¬æ¢
âœ“ è‡ªåŠ¨å¤„ç† .tsx æ–‡ä»¶

# æ”¯æŒ 13 ç§æ¡†æ¶ï¼Œå…¨éƒ¨è‡ªåŠ¨
```

### 4. å¹¶è¡Œæ„å»º

**ä¼ ç»Ÿæ–¹å¼**ï¼ˆä¸²è¡Œï¼‰ï¼š
```
ESM æ„å»º: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10s
ç­‰å¾…...
CJS æ„å»º: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10s  
ç­‰å¾…...
UMD æ„å»º: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10s
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡: 30s
```

**@ldesign/builder**ï¼ˆå¹¶è¡Œï¼‰ï¼š
```
ESM æ„å»º: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10s
CJS æ„å»º: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10s
UMD æ„å»º: â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 10s
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
æ€»è®¡: 12s âš¡ (2.5x æ›´å¿«)
```

æ¯ç§æ ¼å¼ç‹¬ç«‹æ„å»ºï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸ CPUã€‚

### 5. æ™ºèƒ½ç¼“å­˜ç³»ç»Ÿ

**ä¸‰å±‚ç¼“å­˜**ï¼š

```typescript
// L1: å†…å­˜ç¼“å­˜ - æœ€å¿«
const cached = memoryCache.get(key)
if (cached) return cached // 100ms

// L2: ç£ç›˜ç¼“å­˜ - å¿«é€Ÿ
const cached = await diskCache.get(key)  
if (cached) return cached // 500ms

// L3: åˆ†å¸ƒå¼ç¼“å­˜ - å›¢é˜Ÿå…±äº«ï¼ˆå¯é€‰ï¼‰
const cached = await redisCache.get(key)
if (cached) return cached // 1s

// æœªå‘½ä¸­ï¼Œæ‰§è¡Œæ„å»º
const result = await build()
```

**æ•ˆæœ**ï¼š
- é¦–æ¬¡æ„å»º: 10s
- é‡å¤æ„å»º: 2s (5x æ›´å¿«)
- å¢é‡æ„å»º: 500ms (20x æ›´å¿«)

### 6. Monorepo åŸç”Ÿæ”¯æŒ

**é—®é¢˜**ï¼šMonorepo ä¸­çš„åŒ…ç›¸äº’ä¾èµ–

```
packages/
  â”œâ”€â”€ core/        # æ ¸å¿ƒåŒ…
  â”œâ”€â”€ ui/          # ä¾èµ– core
  â””â”€â”€ utils/       # ä¾èµ– core
```

**å…¶ä»–å·¥å…·**ï¼š
- éœ€è¦æ‰‹åŠ¨é…ç½®è·¯å¾„åˆ«å
- éœ€è¦æ‰‹åŠ¨å¤„ç†ä¾èµ–é¡ºåº
- éœ€è¦è‡ªå®šä¹‰è„šæœ¬åè°ƒæ„å»º

**@ldesign/builder**ï¼š
```bash
# è‡ªåŠ¨æ£€æµ‹ Monorepo
âœ“ è¯†åˆ« workspace ç»“æ„
âœ“ åˆ†æåŒ…ä¾èµ–å…³ç³»
âœ“ æŒ‰æ‹“æ‰‘æ’åºæ„å»º
âœ“ å…±äº«æ„å»ºç¼“å­˜

# ä¸€é”®æ„å»ºæ‰€æœ‰åŒ…
ldesign-builder build --monorepo
```

### 7. å®Œå–„çš„é”™è¯¯å¤„ç†

**ä¼ ç»Ÿé”™è¯¯ä¿¡æ¯**ï¼š
```
Error: Cannot resolve 'vue'
  at resolve()
  at bundle()
```
ğŸ˜• **ä»€ä¹ˆæ„æ€ï¼Ÿæ€ä¹ˆè§£å†³ï¼Ÿ**

**@ldesign/builder é”™è¯¯ä¿¡æ¯**ï¼š
```
âœ– ä¾èµ–è§£æé”™è¯¯

é—®é¢˜ï¼š
  æ— æ³•è§£æ 'vue' æ¨¡å—

åŸå› ï¼š
  'vue' è¢«æ ‡è®°ä¸º externalï¼Œä½†æœªåœ¨ package.json çš„
  peerDependencies ä¸­å£°æ˜

è§£å†³æ–¹æ¡ˆï¼š
  1. æ·»åŠ åˆ° peerDependencies:
     {
       "peerDependencies": {
         "vue": "^3.0.0"
       }
     }
  
  2. æˆ–ä» external ä¸­ç§»é™¤:
     {
       external: []
     }

ç›¸å…³æ–‡æ¡£ï¼š
  https://builder.ldesign.com/guide/external
```

âœ¨ **æ¸…æ™°çš„è§£å†³æ–¹æ¡ˆ + ç›¸å…³æ–‡æ¡£**

### 8. å¯è§†åŒ–æ„å»ºæŠ¥å‘Š

æ„å»ºå®Œæˆåè‡ªåŠ¨ç”Ÿæˆï¼š

```bash
âœ“ æ„å»ºæˆåŠŸ

ğŸ“Š ç”Ÿæˆæ„å»ºæŠ¥å‘Š:
  - build-report.html (äº¤äº’å¼å¯è§†åŒ–)
  - build-stats.json (æ•°æ®å¯¼å‡º)
  
æ‰“å¼€æŠ¥å‘Š:
  ldesign-builder analyze --open
```

**æŠ¥å‘Šå†…å®¹**ï¼š
- ğŸ“¦ Bundle å¤§å°åˆ†æï¼ˆé¥¼å›¾ + æ ‘å›¾ï¼‰
- ğŸ“ˆ æ„å»ºæ—¶é—´åˆ†æï¼ˆç€‘å¸ƒå›¾ï¼‰
- ğŸ¯ ä¼˜åŒ–å»ºè®®ï¼ˆè‡ªåŠ¨ç”Ÿæˆï¼‰
- ğŸ“Š ä¾èµ–å…³ç³»å›¾ï¼ˆå¯äº¤äº’ï¼‰
- ğŸ“‰ å†å²è¶‹åŠ¿å¯¹æ¯”

## å®é™…æ¡ˆä¾‹

### æ¡ˆä¾‹ 1: Vue 3 ç»„ä»¶åº“

**ä¹‹å‰**ï¼ˆä½¿ç”¨ Rollupï¼‰ï¼š
```typescript
// rollup.config.js - 120+ è¡Œ
import vue from '@vitejs/plugin-vue'
import typescript from '@rollup/plugin-typescript'
import resolve from '@rollup/plugin-node-resolve'
import commonjs from '@rollup/plugin-commonjs'
import postcss from 'rollup-plugin-postcss'
import { terser } from 'rollup-plugin-terser'
// ... æ›´å¤šé…ç½®

export default [
  {
    input: 'src/index.ts',
    output: [
      { format: 'esm', dir: 'es' },
      { format: 'cjs', dir: 'lib' }
    ],
    plugins: [
      vue(),
      typescript({
        // TypeScript é…ç½®
      }),
      resolve(),
      commonjs(),
      postcss({
        // PostCSS é…ç½®
      }),
      terser()
    ],
    external: ['vue']
  },
  // UMD é…ç½®...
  // æ›´å¤šé…ç½®...
]
```

æ„å»ºæ—¶é—´: **25s**

**ä¹‹å**ï¼ˆä½¿ç”¨ @ldesign/builderï¼‰ï¼š
```bash
# é›¶é…ç½®
npx ldesign-builder build
```

æ„å»ºæ—¶é—´: **8s** (3x æ›´å¿«)

### æ¡ˆä¾‹ 2: React Hooks åº“

**ä¹‹å‰**ï¼š
- é…ç½® TypeScript âœ‹
- é…ç½® React âœ‹
- é…ç½® Babel âœ‹
- å¤„ç†ç±»å‹å£°æ˜ âœ‹
- é…ç½®å¤šæ ¼å¼è¾“å‡º âœ‹

**ä¹‹å**ï¼š
```bash
pnpm add @ldesign/builder -D
npx ldesign-builder build
```

âœ¨ **å…¨éƒ¨è‡ªåŠ¨å®Œæˆ**

### æ¡ˆä¾‹ 3: Monorepo å·¥å…·é›†

**é¡¹ç›®ç»“æ„**ï¼š
```
packages/
  â”œâ”€â”€ @company/core      # 20+ æ¨¡å—
  â”œâ”€â”€ @company/utils     # 30+ æ¨¡å—
  â”œâ”€â”€ @company/ui        # 50+ ç»„ä»¶
  â””â”€â”€ @company/hooks     # 40+ hooks
```

**ä¹‹å‰**ï¼ˆLerna + Rollupï¼‰ï¼š
```bash
# ä¸²è¡Œæ„å»ºï¼Œä¸€ä¸ªä¸€ä¸ªæ¥
lerna run build
# è€—æ—¶: 120s
```

**ä¹‹å**ï¼ˆ@ldesign/builderï¼‰ï¼š
```bash
# å¹¶è¡Œæ„å»ºï¼Œæ™ºèƒ½ç¼“å­˜
ldesign-builder build --monorepo
# è€—æ—¶: 35s (3.4x æ›´å¿«)
```

## æ€§èƒ½å¯¹æ¯”

å®é™…é¡¹ç›®æµ‹è¯•ï¼ˆ1000+ æ¨¡å—ï¼‰ï¼š

| å·¥å…· | é¦–æ¬¡æ„å»º | é‡å¤æ„å»º | å¢é‡æ„å»º | é…ç½®å¤æ‚åº¦ |
|------|---------|---------|---------|-----------|
| **Rollup** | 30s | 30s | 15s | â­â­â­â­â­ |
| **Vite** | 12s | 12s | 5s | â­â­ |
| **tsup** | 5s | 5s | 3s | â­ |
| **@ldesign/builder (esbuild)** | 3s | 1s | 500ms | âœ¨ é›¶é…ç½® |
| **@ldesign/builder (rollup)** | 12s | 2s | 1s | âœ¨ é›¶é…ç½® |

## å¼€å‘ä½“éªŒå¯¹æ¯”

### é…ç½®æ–‡ä»¶è¡Œæ•°

| é¡¹ç›®ç±»å‹ | å…¶ä»–å·¥å…· | @ldesign/builder |
|---------|---------|------------------|
| ç®€å•åº“ | 50-100 è¡Œ | 0 è¡Œ |
| Vue ç»„ä»¶åº“ | 100-150 è¡Œ | 0 è¡Œ |
| React ç»„ä»¶åº“ | 100-150 è¡Œ | 0 è¡Œ |
| Monorepo | 200-300 è¡Œ | 0 è¡Œ |

### å­¦ä¹ æ›²çº¿

```
å¤æ‚åº¦
  â”‚
é«˜â”‚  Webpack
  â”‚  Rollup
  â”‚  
ä¸­â”‚  Vite
  â”‚  esbuild
  â”‚
ä½â”‚  tsup
  â”‚  @ldesign/builder â† ä½ åœ¨è¿™é‡Œ
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> æ—¶é—´
```

## ä½•æ—¶é€‰æ‹©

### âœ… é€‰æ‹© @ldesign/builder

- å¼€å‘ç»„ä»¶åº“æˆ–å·¥å…·åº“
- éœ€è¦å¤šæ ¼å¼è¾“å‡ºï¼ˆESM/CJS/UMDï¼‰
- è¿½æ±‚é›¶é…ç½®å’Œå¿«é€Ÿä¸Šæ‰‹
- Monorepo é¡¹ç›®
- éœ€è¦çµæ´»åˆ‡æ¢æ‰“åŒ…å¼•æ“
- é‡è§†æ„å»ºæ€§èƒ½

### âš ï¸ è€ƒè™‘å…¶ä»–å·¥å…·

- **å¼€å‘åº”ç”¨** â†’ ä½¿ç”¨ Vite/Next.js/Nuxt
- **è¶…å¤æ‚é…ç½®éœ€æ±‚** â†’ ä½¿ç”¨ Rollup/Webpack
- **ä»…éœ€åŸºç¡€åŠŸèƒ½** â†’ ä½¿ç”¨ tsup

## æ€»ç»“

@ldesign/builder çš„æ ¸å¿ƒä»·å€¼ï¼š

1. **èŠ‚çœæ—¶é—´** - é›¶é…ç½®ï¼Œæ— éœ€å­¦ä¹ å¤æ‚çš„é…ç½®
2. **æå‡æ•ˆç‡** - å¤šå¼•æ“é€‰æ‹©ï¼Œå¹¶è¡Œæ„å»º
3. **é™ä½é—¨æ§›** - è‡ªåŠ¨åŒ–å¤„ç†ï¼Œä¸“æ³¨ä¸šåŠ¡
4. **æé«˜è´¨é‡** - æ™ºèƒ½ä¼˜åŒ–ï¼Œå®Œå–„çš„é”™è¯¯å¤„ç†

> **"è®©æ‰“åŒ…å˜å¾—ç®€å•ï¼Œè®©å¼€å‘è€…ä¸“æ³¨äºåˆ›é€ ä»·å€¼"**

## ä¸‹ä¸€æ­¥

- ğŸ“– [å¿«é€Ÿå¼€å§‹](/guide/getting-started) - ç«‹å³ä½“éªŒ
- âš¡ [æ‰“åŒ…å¼•æ“](/guide/bundlers) - äº†è§£å¼•æ“å·®å¼‚
- ğŸ”§ [é…ç½®æ–‡ä»¶](/guide/config-file) - å¯é€‰çš„è‡ªå®šä¹‰
- ğŸ“¦ [Monorepo](/guide/monorepo) - å¤šåŒ…é¡¹ç›®å®è·µ
