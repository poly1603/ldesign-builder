{"version":3,"file":"index.js","sourceRoot":"","sources":["../../src/cli/index.ts"],"names":[],"mappings":"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","sourcesContent":["#!/usr/bin/env node\n\n/**\n * @ldesign/builder CLI 主入口\n * \n * 提供命令行接口来使用 @ldesign/builder\n * \n * @author LDesign Team\n * @version 1.0.0\n */\n\nimport { Command } from 'commander'\nimport chalk from 'chalk'\nimport { readFileSync } from 'fs'\nimport { join, dirname } from 'path'\nimport { fileURLToPath } from 'url'\nimport { buildCommand } from './commands/build'\nimport { watchCommand } from './commands/watch'\nimport { initCommand } from './commands/init'\nimport { analyzeCommand } from './commands/analyze'\nimport { cleanCommand } from './commands/clean'\nimport { examplesCommand } from './commands/examples'\nimport { logger, setLogLevel } from '../utils/logger'\nimport { setupGlobalErrorHandling } from '../utils/error-handler'\n\n// ES 模块中获取 __dirname，兼容 CJS\nconst getFilename = (): string => {\n  if (typeof import.meta !== 'undefined' && import.meta.url) {\n    return fileURLToPath(import.meta.url)\n  }\n  // CJS 环境下的 fallback\n  return typeof __filename !== 'undefined' ? __filename : ''\n}\n\nconst getDirname = (filename: string): string => {\n  if (typeof import.meta !== 'undefined' && import.meta.url) {\n    return dirname(filename)\n  }\n  // CJS 环境下的 fallback\n  return typeof __dirname !== 'undefined' ? __dirname : ''\n}\n\nconst __filename = getFilename()\nconst __dirname = getDirname(__filename)\n\n// 设置全局错误处理\nsetupGlobalErrorHandling()\n\n/**\n * 创建 CLI 程序\n */\nfunction createCLI(): Command {\n  const program = new Command()\n\n  // 基本信息\n  program\n    .name('@ldesign/builder')\n    .description('基于 rollup/rolldown 的通用库打包工具')\n    .version(getVersion(), '-v, --version', '显示版本号')\n\n  // 全局选项\n  program\n    .option('-c, --config <path>', '指定配置文件路径')\n    .option('--bundler <bundler>', '指定打包核心 (rollup|rolldown)', 'rollup')\n    .option('--mode <mode>', '指定构建模式 (development|production)', 'production')\n    .option('--log-level <level>', '设置日志级别 (silent|error|warn|info|debug|verbose)', 'info')\n    .option('--no-colors', '禁用颜色输出')\n    .option('--silent', '静默模式')\n    .option('--debug', '启用调试模式')\n\n  // 注册命令\n  program.addCommand(buildCommand)\n  program.addCommand(watchCommand)\n  program.addCommand(initCommand)\n  program.addCommand(analyzeCommand)\n  program.addCommand(cleanCommand)\n  program.addCommand(examplesCommand)\n\n  // 处理全局选项\n  program.hook('preAction', (thisCommand) => {\n    const options = thisCommand.opts()\n\n    // 设置日志级别\n    if (options.silent) {\n      setLogLevel('silent')\n    } else if (options.debug) {\n      setLogLevel('debug')\n    } else if (options.logLevel) {\n      setLogLevel(options.logLevel)\n    }\n\n    // 设置颜色\n    if (options.noColors) {\n      process.env.NO_COLOR = '1'\n    }\n  })\n\n  // 错误处理\n  program.exitOverride((err) => {\n    if (err.code === 'commander.help') {\n      process.exit(0)\n    }\n    if (err.code === 'commander.version') {\n      process.exit(0)\n    }\n    if (err.code === 'commander.helpDisplayed') {\n      process.exit(0)\n    }\n\n    logger.error('命令执行失败:', err.message)\n    process.exit(1)\n  })\n\n  return program\n}\n\n/**\n * 获取版本号\n */\nfunction getVersion(): string {\n  try {\n    const packageJsonPath = join(__dirname, '../../package.json')\n    const packageJson = JSON.parse(readFileSync(packageJsonPath, 'utf-8'))\n    return packageJson.version\n  } catch {\n    return '1.0.0'\n  }\n}\n\n/**\n * 显示欢迎信息\n */\nfunction showWelcome(): void {\n  const version = getVersion()\n  console.log()\n  console.log(chalk.cyan.bold('  @ldesign/builder'))\n  console.log(chalk.gray(`  v${version}`))\n  console.log()\n  console.log(chalk.gray('  基于 rollup/rolldown 的通用库打包工具'))\n  console.log()\n}\n\n/**\n * 主函数\n */\nasync function main(): Promise<void> {\n  try {\n    const program = createCLI()\n\n    // 如果没有参数，显示帮助\n    if (process.argv.length <= 2) {\n      showWelcome()\n      program.help()\n      return\n    }\n\n    // 解析命令行参数\n    await program.parseAsync(process.argv)\n\n  } catch (error) {\n    logger.error('CLI 启动失败:', error)\n    process.exit(1)\n  }\n}\n\n// 导出 CLI 类\nexport class BuilderCLI {\n  static async createSimpleCLI() {\n    return main()\n  }\n}\n\n// 运行 CLI (ES 模块中检查是否为主模块)\nif (typeof import.meta !== 'undefined' && import.meta.url === `file://${process.argv[1]}`) {\n  main().catch((error) => {\n    logger.error('未处理的错误:', error)\n    process.exit(1)\n  })\n}\n\nexport { createCLI, main }\n"]}