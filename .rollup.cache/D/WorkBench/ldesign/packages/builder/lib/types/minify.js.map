{"version":3,"file":"minify.js","sourceRoot":"","sources":["../../src/types/minify.ts"],"names":[],"mappings":"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","sourcesContent":["/**\n * 压缩配置类型定义\n * \n * @author LDesign Team\n * @version 1.0.0\n */\n\n/**\n * 压缩级别\n */\nexport type MinifyLevel = 'none' | 'whitespace' | 'basic' | 'advanced'\n\n/**\n * 压缩选项\n */\nexport interface MinifyOptions {\n  /** 压缩级别 */\n  level?: MinifyLevel\n  \n  /** 是否压缩 JavaScript */\n  js?: boolean | JSMinifyOptions\n  \n  /** 是否压缩 CSS */\n  css?: boolean | CSSMinifyOptions\n  \n  /** 是否压缩 HTML */\n  html?: boolean | HTMLMinifyOptions\n  \n  /** 是否保留注释 */\n  comments?: boolean | 'some' | RegExp\n  \n  /** 是否保留许可证注释 */\n  legal?: boolean\n  \n  /** 是否生成 source map */\n  sourcemap?: boolean\n  \n  /** 自定义压缩器 */\n  customMinifier?: {\n    js?: (code: string, options?: any) => string | Promise<string>\n    css?: (code: string, options?: any) => string | Promise<string>\n  }\n}\n\n/**\n * JavaScript 压缩选项\n */\nexport interface JSMinifyOptions {\n  /** 压缩器类型 */\n  minifier?: 'terser' | 'esbuild' | 'swc'\n  \n  /** 是否混淆变量名 */\n  mangle?: boolean | {\n    /** 保留的变量名 */\n    reserved?: string[]\n    /** 是否混淆属性名 */\n    properties?: boolean\n  }\n  \n  /** 是否压缩代码 */\n  compress?: boolean | {\n    /** 是否移除 console */\n    drop_console?: boolean\n    /** 是否移除 debugger */\n    drop_debugger?: boolean\n    /** 是否移除未使用的代码 */\n    dead_code?: boolean\n    /** 是否内联函数 */\n    inline?: boolean\n  }\n  \n  /** 输出格式选项 */\n  format?: {\n    /** 是否保留注释 */\n    comments?: boolean | 'some' | RegExp\n    /** 是否美化输出 */\n    beautify?: boolean\n    /** 缩进大小 */\n    indent_size?: number\n  }\n  \n  /** 是否保留函数名 */\n  keep_fnames?: boolean\n  \n  /** 是否保留类名 */\n  keep_classnames?: boolean\n  \n  /** 目标环境 */\n  target?: string | string[]\n}\n\n/**\n * CSS 压缩选项\n */\nexport interface CSSMinifyOptions {\n  /** 压缩器类型 */\n  minifier?: 'cssnano' | 'clean-css' | 'lightningcss'\n  \n  /** 是否移除未使用的 CSS */\n  removeUnused?: boolean\n  \n  /** 是否合并相同的规则 */\n  mergeRules?: boolean\n  \n  /** 是否压缩颜色值 */\n  colormin?: boolean\n  \n  /** 是否压缩字体 */\n  minifyFontValues?: boolean\n  \n  /** 是否压缩选择器 */\n  minifySelectors?: boolean\n  \n  /** 是否移除注释 */\n  discardComments?: boolean\n  \n  /** 是否移除空规则 */\n  discardEmpty?: boolean\n  \n  /** 浏览器兼容性 */\n  browsers?: string | string[]\n}\n\n/**\n * HTML 压缩选项\n */\nexport interface HTMLMinifyOptions {\n  /** 是否移除注释 */\n  removeComments?: boolean\n  \n  /** 是否移除空白符 */\n  collapseWhitespace?: boolean\n  \n  /** 是否移除空属性 */\n  removeEmptyAttributes?: boolean\n  \n  /** 是否移除冗余属性 */\n  removeRedundantAttributes?: boolean\n  \n  /** 是否压缩内联 CSS */\n  minifyCSS?: boolean\n  \n  /** 是否压缩内联 JS */\n  minifyJS?: boolean\n}\n\n/**\n * 预设压缩配置\n */\nexport const MINIFY_PRESETS: Record<MinifyLevel, MinifyOptions> = {\n  none: {\n    level: 'none',\n    js: false,\n    css: false,\n    html: false,\n    comments: true,\n    legal: true\n  },\n  \n  whitespace: {\n    level: 'whitespace',\n    js: {\n      minifier: 'esbuild',\n      mangle: false,\n      compress: false,\n      format: {\n        comments: true,\n        beautify: false\n      }\n    },\n    css: {\n      minifier: 'clean-css',\n      removeUnused: false,\n      mergeRules: false,\n      discardComments: false\n    },\n    html: {\n      collapseWhitespace: true,\n      removeComments: false,\n      minifyCSS: false,\n      minifyJS: false\n    },\n    comments: true,\n    legal: true\n  },\n  \n  basic: {\n    level: 'basic',\n    js: {\n      minifier: 'terser',\n      mangle: false,\n      compress: {\n        drop_console: false,\n        drop_debugger: true,\n        dead_code: true,\n        inline: false\n      },\n      format: {\n        comments: 'some'\n      }\n    },\n    css: {\n      minifier: 'cssnano',\n      removeUnused: false,\n      mergeRules: true,\n      colormin: true,\n      discardComments: false,\n      discardEmpty: true\n    },\n    html: {\n      collapseWhitespace: true,\n      removeComments: false,\n      removeEmptyAttributes: true,\n      minifyCSS: true,\n      minifyJS: false\n    },\n    comments: 'some',\n    legal: true\n  },\n  \n  advanced: {\n    level: 'advanced',\n    js: {\n      minifier: 'terser',\n      mangle: {\n        reserved: [],\n        properties: false\n      },\n      compress: {\n        drop_console: true,\n        drop_debugger: true,\n        dead_code: true,\n        inline: true\n      },\n      format: {\n        comments: false\n      }\n    },\n    css: {\n      minifier: 'cssnano',\n      removeUnused: true,\n      mergeRules: true,\n      colormin: true,\n      minifyFontValues: true,\n      minifySelectors: true,\n      discardComments: true,\n      discardEmpty: true\n    },\n    html: {\n      collapseWhitespace: true,\n      removeComments: true,\n      removeEmptyAttributes: true,\n      removeRedundantAttributes: true,\n      minifyCSS: true,\n      minifyJS: true\n    },\n    comments: false,\n    legal: true\n  }\n}\n\n/**\n * 获取压缩配置\n */\nexport function getMinifyConfig(options: boolean | MinifyLevel | MinifyOptions): MinifyOptions {\n  if (typeof options === 'boolean') {\n    return options ? MINIFY_PRESETS.basic : MINIFY_PRESETS.none\n  }\n  \n  if (typeof options === 'string') {\n    return MINIFY_PRESETS[options] || MINIFY_PRESETS.basic\n  }\n  \n  return options\n}\n\n/**\n * 合并压缩配置\n */\nexport function mergeMinifyConfig(base: MinifyOptions, override: Partial<MinifyOptions>): MinifyOptions {\n  return {\n    ...base,\n    ...override,\n    js: typeof override.js === 'object' && typeof base.js === 'object' \n      ? { ...base.js, ...override.js }\n      : override.js ?? base.js,\n    css: typeof override.css === 'object' && typeof base.css === 'object'\n      ? { ...base.css, ...override.css }\n      : override.css ?? base.css,\n    html: typeof override.html === 'object' && typeof base.html === 'object'\n      ? { ...base.html, ...override.html }\n      : override.html ?? base.html\n  }\n}\n"]}