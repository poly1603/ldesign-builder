# @ldesign/builder 使用指南

> 🚀 零配置、极速、智能的前端库打包工具

---

## 🎯 核心特性

### ✨ 零配置
90% 的项目无需任何配置，自动检测和构建

### ⚡ 极速构建
- 开发模式：**10-100 倍**速度提升
- 生产构建：**3 倍**速度提升
- 并行打包：**2.5 倍**速度提升

### 🔧 全框架支持
支持 11 种主流框架：Vue2/3、React、Svelte、Solid、Preact、Lit、Angular、Qwik、TypeScript、样式库

### 🚀 多引擎可选
4 种打包引擎智能选择：esbuild、swc、rollup、rolldown

---

## 📦 快速开始

### 安装

```bash
pnpm add @ldesign/builder -D
```

### 零配置构建

```bash
npx ldesign-builder build
```

就这么简单！所有配置自动完成 ✨

---

## 💡 智能功能

### 1. 自动检测项目类型

工具会自动检测您的项目：

```
检测 package.json → 分析依赖 → 扫描文件结构 → 推断项目类型
```

支持的项目类型：
- Vue 2/3 组件库
- React 组件库
- TypeScript 工具库
- Svelte、Solid、Preact、Lit 组件库
- 纯样式库（CSS/Less/Sass）
- Monorepo 项目

### 2. 自动推断配置

自动推断以下配置：

| 配置项 | 推断逻辑 |
|--------|----------|
| **入口文件** | 查找 `src/index.ts/tsx/js/jsx/vue` |
| **输出格式** | 组件库：ESM+CJS+UMD<br>工具库：ESM+CJS |
| **输出目录** | ESM → es/<br>CJS → lib/<br>UMD → dist/ |
| **外部依赖** | 从 peerDependencies 读取 |
| **UMD 名称** | 从 package.json name 生成 |
| **打包引擎** | 开发 → esbuild<br>生产 → swc/rollup |

### 3. 自动优化

- ✅ 自动 Tree Shaking
- ✅ 自动代码分割
- ✅ 自动生成类型声明
- ✅ 自动生成 sourcemap
- ✅ 并行构建多格式

---

## 🎨 使用场景

### 场景 1: Vue 3 组件库

```bash
# 项目结构
my-vue-lib/
├── package.json      # peerDependencies: { "vue": "^3.0.0" }
└── src/
    ├── index.ts
    └── Button.vue

# 零配置构建
npx ldesign-builder build

# 输出
✓ 检测到 Vue 3 项目
✓ 生成 ESM (es/)
✓ 生成 CJS (lib/)
✓ 生成 UMD (dist/MyVueLib.umd.js)
✓ 生成类型声明
✓ 构建完成 (12s)
```

### 场景 2: TypeScript 工具库

```bash
# 项目结构
my-utils/
├── package.json
└── src/
    ├── index.ts
    └── helpers/

# 零配置构建
npx ldesign-builder build

# 输出
✓ 检测到 TypeScript 项目
✓ 生成 ESM (es/)
✓ 生成 CJS (lib/)
✓ 保留目录结构
✓ 构建完成 (5s)
```

### 场景 3: React 组件库

```bash
# 项目结构
my-react-lib/
├── package.json      # peerDependencies: { "react": "^18.0.0" }
└── src/
    ├── index.tsx
    └── components/

# 零配置构建
npx ldesign-builder build

# 输出
✓ 检测到 React 项目
✓ 生成 ESM (es/)
✓ 生成 CJS (lib/)
✓ 支持 JSX/TSX
✓ 构建完成 (10s)
```

---

## ⚡ 性能模式

### 极速开发模式

```bash
# 使用 esbuild（10-100倍速度）
npx ldesign-builder build --mode development

# 或在 package.json 中
{
  "scripts": {
    "dev": "ldesign-builder build --mode development --watch"
  }
}
```

**效果**: 5s → 0.5s ⚡

### 快速生产模式

```bash
# 使用 swc（20倍速度）
npx ldesign-builder build --mode production

# 或
pnpm build
```

**效果**: 30s → 10s 🚀

### 指定打包引擎

```bash
# 极速：esbuild
npx ldesign-builder build --bundler esbuild

# 快速：swc
npx ldesign-builder build --bundler swc

# 稳定：rollup
npx ldesign-builder build --bundler rollup

# 默认：rolldown
npx ldesign-builder build --bundler rolldown
```

---

## 🎨 可选配置

### 最小配置（推荐）

只在需要时创建 `.ldesign/builder.config.ts`：

```typescript
export default {
  // 只配置需要覆盖的部分
  name: 'MyLib',  // 可选，自动从 package.json 读取
  external: ['lodash']  // 可选，额外的外部依赖
}
```

### 常用配置

```typescript
export default {
  // 基础
  name: 'MyLib',
  
  // 外部依赖（可选，自动从 peerDependencies 读取）
  external: ['vue', 'lodash'],
  
  // 指定引擎（可选，自动选择）
  bundler: 'swc',
  
  // 输出格式（可选，自动推断）
  output: {
    esm: true,
    cjs: true,
    umd: true
  }
}
```

### 完整配置示例

```typescript
export default {
  // 入口（可选，自动检测）
  input: 'src/index.ts',
  
  // 库名称
  name: 'MyAwesomeLib',
  
  // 引擎选择
  bundler: 'rollup',
  
  // 输出配置
  output: {
    esm: {
      dir: 'es',
      preserveStructure: true,
      dts: true
    },
    cjs: {
      dir: 'lib',
      preserveStructure: true,
      dts: true
    },
    umd: {
      dir: 'dist',
      minify: true
    }
  },
  
  // 外部依赖
  external: ['vue', 'lodash'],
  
  // 全局变量（UMD）
  globals: {
    vue: 'Vue',
    lodash: '_'
  }
}
```

---

## 📁 输出结构

### 默认输出

```
your-project/
├── es/              # ESM 格式 (现代 import)
│   ├── index.js
│   ├── index.d.ts
│   └── components/
│
├── lib/             # CJS 格式 (Node require)
│   ├── index.cjs
│   ├── index.d.ts
│   └── components/
│
├── dist/            # UMD 格式 (浏览器)
│   └── index.umd.js
│
└── .ldesign/
    └── build-manifest.json  # 构建清单
```

### Package.json 配置

自动生成（或手动配置）：

```json
{
  "main": "./lib/index.cjs",
  "module": "./es/index.js",
  "types": "./es/index.d.ts",
  "exports": {
    ".": {
      "import": "./es/index.js",
      "require": "./lib/index.cjs",
      "types": "./es/index.d.ts"
    }
  }
}
```

---

## 🔥 高级功能

### 并行构建

自动启用，无需配置：

```bash
# 自动并行构建 ESM + CJS + UMD
npx ldesign-builder build

# 输出
⚡ 并行构建 3 种格式...
✓ ESM 完成 (4s)
✓ CJS 完成 (4s)
✓ UMD 完成 (4s)
✓ 总计 4s（串行需要 12s）
```

### 监听模式

```bash
npx ldesign-builder build --watch
```

### 构建分析

```bash
npx ldesign-builder build --analyze
```

### 调试模式

```bash
npx ldesign-builder build --debug
```

---

## ❓ 常见问题

### Q: 需要配置文件吗？
**A**: 90% 的项目不需要！工具会自动检测和配置。

### Q: 如何加速构建？
**A**: 
- 开发模式：`--mode development` (使用 esbuild)
- 或安装可选依赖：`pnpm add esbuild @swc/core -D`

### Q: 支持 Monorepo 吗？
**A**: 完全支持！自动检测 pnpm workspace、lerna、nx 等。

### Q: 输出目录可以自定义吗？
**A**: 可以，在配置文件中指定：
```typescript
export default {
  output: {
    esm: { dir: 'esm' },
    cjs: { dir: 'cjs' }
  }
}
```

### Q: 如何选择打包引擎？
**A**: 
- 自动选择（推荐）：什么都不配置
- 手动指定：`--bundler esbuild|swc|rollup|rolldown`

---

## 📚 相关文档

- [快速开始](./QUICK_START_ZH.md)
- [最终报告](./FINAL_REPORT.md)
- [实施总结](./IMPLEMENTATION_SUMMARY.md)
- [完成状态](./COMPLETION_STATUS.md)
- [README](./README.md)

---

## 💬 获取帮助

- 📖 查看完整文档
- 🐛 提交 Issue
- 💡 查看示例项目

---

**开始使用吧！** 🚀

```bash
npx ldesign-builder build
```



